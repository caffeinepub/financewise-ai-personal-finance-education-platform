{
  "kind": "build_request",
  "title": "Fix Analytics transaction saving, enable AI chat unlimited scrolling, remove Challenges, and add working display preferences",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update the AI assistant chat UI (frontend/src/components/AIChatbot.tsx) so long conversations are fully scrollable without cutting off messages, with reliable auto-scroll-to-latest behavior after new messages are appended.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-1"
        ],
        "quotes": [
          "add a scrolling in ai assistant which can chat at infinite",
          "simply allow long conversation without cutting off messages"
        ]
      },
      "acceptanceCriteria": [
        "User can send 200+ messages in one session and all messages remain visible via scrolling (none disappear or get clipped).",
        "After sending/receiving a message, the chat view scrolls to the latest message reliably.",
        "No console errors related to scroll container refs."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Fix Analytics page add-income and add-expense flows so clicking “Add Expense” and “Add Income” persists the new transaction and refreshes analytics data correctly.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-1"
        ],
        "quotes": [
          "in analytics page not adding income or expense check and resolve",
          "values are not being saved i mean adding income and expense button is not working"
        ]
      },
      "acceptanceCriteria": [
        "Submitting the Add Expense form creates a new expense transaction that persists (still present after page refresh) and appears in analytics charts/derived data.",
        "Submitting the Add Income form creates a new income transaction that persists (still present after page refresh) and appears in analytics charts/derived data.",
        "No runtime error occurs during transaction persistence (including JSON serialization issues).",
        "After a successful add, the form fields reset as they currently attempt to do."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Ensure the Analytics “Remaining Balance” display never renders as a bare dash/minus due to missing/invalid data; when there are no transactions, show a zero balance and consistent currency formatting.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-1"
        ],
        "quotes": [
          "and balance should not be -"
        ]
      },
      "acceptanceCriteria": [
        "With zero saved transactions, Remaining Balance renders as a formatted 0 value (not '-' and not NaN).",
        "With valid income/expense transactions, Remaining Balance renders correctly and updates after adding a transaction."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Remove the Challenges feature from the app UI and routing: eliminate the Challenges navigation entry and disable/remove the /challenges route so users cannot navigate to the Challenges page.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-1"
        ],
        "quotes": [
          "remove challenge page"
        ]
      },
      "acceptanceCriteria": [
        "The sidebar/navigation no longer shows “Challenges”.",
        "Visiting /challenges does not render the Challenges page (route removed or replaced with a not-found/redirect behavior consistent with the app).",
        "No build errors remain from stale imports/references to the Challenges page."
      ]
    },
    {
      "id": "REQ-5",
      "text": "Make Settings display preferences functional: (1) theme selection (light/dark/system) must actually change the app theme, and (2) the “Show Analytics” toggle must control visibility/access to Analytics in the app navigation and/or page access.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-1"
        ],
        "quotes": [
          "in settings display preference like theme and show analytics should work",
          "Yes like on or off"
        ]
      },
      "acceptanceCriteria": [
        "Changing Theme in Settings immediately updates the app theme and the selection persists across reloads.",
        "If “Show Analytics” is turned off, the Analytics navigation item is hidden and the user is prevented from accessing the Analytics experience (either via route guard message or redirect).",
        "If “Show Analytics” is turned on, Analytics is accessible and appears in navigation again.",
        "All user-facing text for these controls remains in English."
      ]
    }
  ],
  "constraints": [
    "Do not edit files under frontend/immutablePaths (e.g., frontend/src/hooks/useInternetIdentity.ts(x), frontend/src/hooks/useActor.ts, frontend/src/main.tsx, and anything in frontend/src/components/ui).",
    "Keep the backend as a single Motoko actor; add migration.mo only if existing persisted backend state must be upgraded (not required for purely frontend localStorage fixes)."
  ],
  "nonGoals": [
    "Implementing true infinite-scroll history loading for chat (loading older messages from storage/server) beyond allowing long conversations in the current UI.",
    "Adding new Challenge replacements or gamification features.",
    "Introducing third-party auth providers or external databases."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}