{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Frontend Implementation: Backend-First Data Persistence with Internet Identity Authentication",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Implement Internet Identity authentication system that manages login/logout flow and persists authentication state across browser sessions",
      "acceptanceCriteria": [
        "Users can log in using Internet Identity (passkeys, Google, Apple, or Microsoft)",
        "Authentication state persists across browser refresh",
        "Logout clears frontend state but preserves all backend data",
        "Login redirects to Dashboard after successful authentication"
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/Login.tsx",
          "operation": "modify",
          "description": "Update login page to redirect authenticated users to Dashboard using TanStack Router navigation. Add error handling for failed authentication attempts and loading states during login process."
        },
        {
          "path": "frontend/src/components/AppLayout.tsx",
          "operation": "modify",
          "description": "Verify logout handler properly clears React Query cache using queryClient.clear() and does not trigger any backend delete operations. Ensure authentication state is cleared while preserving all backend data."
        }
      ]
    },
    {
      "id": "REQ-4",
      "summary": "Modify Dashboard page to fetch all data from backend on mount and after any mutation, never relying on frontend-only state for persistence",
      "acceptanceCriteria": [
        "Dashboard fetches user data from backend on component mount",
        "After adding/editing income or expenses, data refetches from backend",
        "Data persists after browser refresh",
        "Loading states display while fetching data"
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/Dashboard.tsx",
          "operation": "modify",
          "description": "Refactor Dashboard to fetch all financial data from backend using existing hooks (useGetTransactions, useGetAIPrediction, useGetUserPreferences). Remove any localStorage or frontend-only state for critical data. Add loading states during data fetches. After adding income or expenses via mutations, ensure React Query invalidates and refetches the relevant queries to display fresh backend data."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Review and update useAddTransaction and related mutation hooks to ensure they invalidate the ['transactions'] query key on success, triggering automatic refetch of transaction data from backend."
        }
      ]
    },
    {
      "id": "REQ-5",
      "summary": "Modify Transactions page to fetch transaction history from backend and implement add/edit/delete operations that save immediately to backend",
      "acceptanceCriteria": [
        "Transactions page fetches all transactions from backend on mount",
        "Add transaction saves to backend and refetches data",
        "Edit transaction updates backend and refetches data",
        "Delete transaction removes from backend and refetches data",
        "All transaction data persists after logout and login"
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/Transactions.tsx",
          "operation": "modify",
          "description": "Refactor Transactions page to use backend CRUD operations via useAddTransaction, useDeleteTransaction hooks. Remove any localStorage dependencies for transaction data. Ensure all operations (add, edit, delete) trigger query invalidation and refetch from backend. Add loading and error states for all mutation operations."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Add useUpdateTransaction mutation hook that calls backend updateTransaction (if not already present) and invalidates ['transactions'] query on success. Ensure useDeleteTransaction properly invalidates queries after deletion."
        }
      ]
    },
    {
      "id": "REQ-6",
      "summary": "Modify Goals page to fetch savings goals from backend and implement CRUD operations with immediate backend persistence",
      "acceptanceCriteria": [
        "Goals page fetches all savings goals from backend on mount",
        "Creating new goals saves to backend immediately",
        "Updating goal progress saves to backend immediately",
        "Deleting goals removes from backend immediately",
        "Goal data persists across sessions"
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/Goals.tsx",
          "operation": "modify",
          "description": "Refactor Goals page to use backend CRUD operations via useAddSavingsGoal, useUpdateSavingsGoal, useDeleteSavingsGoal hooks. Remove any localStorage dependencies for goal data. Ensure all operations immediately save to backend and trigger query invalidation to refetch fresh data. Add loading states during mutations and display error messages for failed operations."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Review and ensure useAddSavingsGoal, useUpdateSavingsGoal, and useDeleteSavingsGoal hooks properly invalidate ['savingsGoals'] query key on success to trigger refetch from backend."
        }
      ]
    },
    {
      "id": "REQ-7",
      "summary": "Modify Analytics page to fetch transaction data and user preferences from backend, ensuring all analytics calculations are based on backend data",
      "acceptanceCriteria": [
        "Analytics page fetches transaction data from backend on mount",
        "All charts and statistics calculate from backend data",
        "Adding transactions through Analytics form saves to backend",
        "Analytics preferences sync with backend user preferences",
        "Data remains available after logout/login cycle"
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/Analytics.tsx",
          "operation": "modify",
          "description": "Refactor Analytics page to fetch transaction data using useGetTransactions hook and user preferences using useGetUserPreferences hook. Remove any frontend-only calculations or cached data. Ensure all charts and statistics derive from backend data. When adding transactions via the Analytics form, use backend mutation hooks and trigger query invalidation to refetch updated data."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Ensure useGetUserPreferences hook is properly configured and that any preference updates invalidate the ['userPreferences'] query key to refetch from backend."
        }
      ]
    },
    {
      "id": "REQ-8",
      "summary": "Modify Budget Planner page to save budget plans to backend and fetch them on page load",
      "acceptanceCriteria": [
        "Budget plans save to backend when generated",
        "Budget page fetches saved plans from backend on mount",
        "Budget data persists across sessions",
        "Users can view their previous budget plans after logout/login"
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/BudgetPlanner.tsx",
          "operation": "modify",
          "description": "Refactor Budget Planner to fetch saved budget data from backend using useGetBudgetData hook on component mount. After generating or updating budget plans, save them to backend using useSaveBudgetData mutation hook and invalidate ['budgetData'] query to refetch. Remove any localStorage dependencies for budget data. Add loading states during fetch and save operations."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Add or review useGetBudgetData and useSaveBudgetData hooks to ensure they properly fetch and persist budget plans to backend, with query invalidation on successful mutations."
        }
      ]
    },
    {
      "id": "REQ-9",
      "summary": "Modify Calculators page to save calculation history to backend and fetch previous calculations on page load",
      "acceptanceCriteria": [
        "Calculator results save to backend after computation",
        "Calculators page shows calculation history from backend",
        "Calculation history persists across sessions",
        "Users can access previous calculations after logout/login"
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/Calculators.tsx",
          "operation": "modify",
          "description": "Refactor Calculators page to save calculation results to backend after each computation using a new mutation hook (e.g., useSaveCalculationHistory). Fetch previous calculation history from backend on mount using a new query hook (e.g., useGetCalculationHistory). Remove any localStorage dependencies for calculation data. Add UI to display calculation history and loading states."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Add useGetCalculationHistory query hook and useSaveCalculationHistory mutation hook to fetch and persist calculator results to backend. Ensure mutation invalidates ['calculationHistory'] query key on success."
        }
      ]
    },
    {
      "id": "REQ-10",
      "summary": "Modify AI Insights page to fetch AI predictions from backend and ensure prediction generation saves results to backend",
      "acceptanceCriteria": [
        "AI Insights page fetches predictions from backend on mount",
        "Generating new predictions saves results to backend",
        "Prediction data persists across sessions",
        "Users see their previous predictions after logout/login"
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/AIInsights.tsx",
          "operation": "modify",
          "description": "Refactor AI Insights page to fetch AI predictions from backend using useGetAIPrediction hook on mount. After generating new predictions, save them to backend using useSaveAIPrediction mutation hook and invalidate ['aiPrediction'] query to refetch. Remove any frontend-only prediction storage. Add loading states during fetch and generation operations."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Review and ensure useGetAIPrediction and useSaveAIPrediction hooks properly fetch and persist prediction data to backend with query invalidation on success."
        }
      ]
    },
    {
      "id": "REQ-11",
      "summary": "Modify Quiz/Learning pages to save quiz progress and scores to backend keyed by user Principal",
      "acceptanceCriteria": [
        "Quiz progress saves to backend after each question",
        "Quiz completion scores save to backend",
        "Quiz page loads previous progress from backend",
        "Quiz history persists across sessions and devices"
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/Quiz.tsx",
          "operation": "modify",
          "description": "Refactor Quiz page to save quiz progress to backend after each question submission using useSubmitQuizAnswer mutation hook. Fetch quiz progress from backend on mount using useInitializeQuiz or useGetQuizStatistics hooks. Remove localStorage dependencies from frontend/src/lib/quizProgressStorage.ts usage. Ensure quiz completion scores persist to backend. Add loading states during progress saves."
        },
        {
          "path": "frontend/src/pages/Learning.tsx",
          "operation": "modify",
          "description": "Update Learning page to fetch quiz statistics and progress from backend using useGetQuizStatistics hook. Remove any localStorage dependencies for displaying progress. Ensure all displayed statistics reflect backend state."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Review useSubmitQuizAnswer, useInitializeQuiz, and useGetQuizStatistics hooks to ensure they properly save and fetch quiz progress to/from backend with appropriate query invalidations."
        }
      ]
    },
    {
      "id": "REQ-12",
      "summary": "Implement Settings page backend integration to save user preferences (theme, notifications, analytics visibility, currency) to backend and fetch on page load",
      "acceptanceCriteria": [
        "Settings changes save immediately to backend",
        "Settings page fetches preferences from backend on mount",
        "Theme preference persists across sessions",
        "Currency preference applies consistently across all pages",
        "Preferences sync across devices for the same user"
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/Settings.tsx",
          "operation": "modify",
          "description": "Refactor Settings page to fetch user preferences from backend using useGetUserPreferences hook on mount. When user changes preferences (theme, notifications, analytics visibility, currency), save immediately to backend using useSaveUserPreferences mutation hook and invalidate ['userPreferences'] query. Remove any localStorage dependencies for preferences. Add loading states during save operations and success/error feedback."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Review and ensure useGetUserPreferences and useSaveUserPreferences hooks properly fetch and persist preferences to backend with query invalidation on success."
        }
      ]
    },
    {
      "id": "REQ-13",
      "summary": "Update all React Query hooks to invalidate and refetch data after mutations, ensuring frontend always displays current backend state",
      "acceptanceCriteria": [
        "All mutation hooks trigger query invalidation on success",
        "Data refetches automatically after create/update/delete operations",
        "Loading states display during refetch operations",
        "Error states handle failed refetch attempts"
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Audit all mutation hooks (useAddTransaction, useDeleteTransaction, useUpdateTransaction, useAddSavingsGoal, useUpdateSavingsGoal, useDeleteSavingsGoal, useSaveUserPreferences, useSaveBudgetData, useSaveAIPrediction, useSubmitQuizAnswer, etc.) to ensure they call queryClient.invalidateQueries with appropriate query keys on success. Ensure loading and error states are properly exposed. Add consistent error handling across all mutations."
        }
      ]
    },
    {
      "id": "REQ-14",
      "summary": "Implement comprehensive data persistence testing across all private pages to verify data survives browser refresh, logout/login cycles, and cross-device access",
      "acceptanceCriteria": [
        "All private page data persists after browser refresh",
        "All private page data persists after logout and login",
        "Users can access their data from different browsers/devices",
        "No data loss occurs during authentication transitions",
        "Each user only sees their own isolated data"
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/Dashboard.tsx",
          "operation": "modify",
          "description": "Add console logging or developer-mode indicators to verify data is fetched from backend on mount and after mutations. Ensure no localStorage usage for critical data."
        },
        {
          "path": "frontend/src/pages/Transactions.tsx",
          "operation": "modify",
          "description": "Add console logging to verify transaction CRUD operations persist to backend and refetch correctly after browser refresh and logout/login cycles."
        },
        {
          "path": "frontend/src/pages/Goals.tsx",
          "operation": "modify",
          "description": "Add console logging to verify goal CRUD operations persist to backend and survive browser refresh and authentication transitions."
        },
        {
          "path": "frontend/src/pages/Analytics.tsx",
          "operation": "modify",
          "description": "Add console logging to verify analytics data is always fetched from backend and calculations reflect current backend state."
        },
        {
          "path": "frontend/src/pages/BudgetPlanner.tsx",
          "operation": "modify",
          "description": "Add console logging to verify budget plans persist to backend and are retrieved correctly after logout/login."
        },
        {
          "path": "frontend/src/pages/Calculators.tsx",
          "operation": "modify",
          "description": "Add console logging to verify calculation history persists to backend and loads correctly across sessions."
        },
        {
          "path": "frontend/src/pages/AIInsights.tsx",
          "operation": "modify",
          "description": "Add console logging to verify AI predictions persist to backend and are available after authentication transitions."
        },
        {
          "path": "frontend/src/pages/Quiz.tsx",
          "operation": "modify",
          "description": "Add console logging to verify quiz progress persists to backend and loads correctly after logout/login on different devices."
        },
        {
          "path": "frontend/src/pages/Settings.tsx",
          "operation": "modify",
          "description": "Add console logging to verify user preferences persist to backend and sync correctly across devices after logout/login."
        }
      ]
    },
    {
      "id": "REQ-15",
      "summary": "Update AppLayout logout handler to clear all frontend state and query cache while preserving backend data",
      "acceptanceCriteria": [
        "Logout clears React Query cache",
        "Logout clears authentication state",
        "Logout does not trigger any backend delete operations",
        "Backend data remains intact after logout",
        "Next login successfully fetches all preserved data"
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/AppLayout.tsx",
          "operation": "modify",
          "description": "Review and verify logout handler calls queryClient.clear() to clear React Query cache and useInternetIdentity clear() to clear authentication state. Ensure no backend delete operations are triggered during logout. Add comments documenting that backend data must remain intact. Test that subsequent login successfully fetches all preserved user data."
        }
      ]
    }
  ]
}